@using Syncfusion.Blazor.Buttons
@using Services
@inherits RegisterSectionBase
@inject PositionsService _posService

@code {

    [Parameter]
    public EventCallback<PreferredPositionsData> PositionsDataChanged { get; set; }
    [Parameter]
    public PreferredPositionsData PositionsData { get; set; }

    private List<Position> positions = new List<Position>();

    protected override async Task OnInitializedAsync()
    {
        positions = await _posService.GetPositions();

        if (!PositionsData.SelectedPositions.Any())
        {
            foreach (var position in positions)
            {
                if (position != null)
                {
                    PositionsData.SelectedPositions.Add(position.Id, new PreferredPositionsData.PositonSelection() { PositionWasSelected = false });
                }
            }
        }
    }

    protected override async Task GoToNextSection()
    {
        await PositionsDataChanged.InvokeAsync(PositionsData);
        await base.GoToNextSection();
    }

    protected override async Task HandlePreviousSectionRequested()
    {
        await PositionsDataChanged.InvokeAsync(PositionsData);
        await base.HandlePreviousSectionRequested();
    }

    protected override async Task HandleDifferentSectionRequested()
    {
        await PositionsDataChanged.InvokeAsync(PositionsData);
        await base.HandlePreviousSectionRequested();
    }
}

<h5>What volunteering positions interest you most?</h5>
<br/>
<EditForm Model="PositionsData" OnValidSubmit="GoToNextSection">
    <DataAnnotationsValidator />
    <div id="positions-container" class="d-flex">
        @if (positions.Any(p => p != null))
        {
            foreach (var position in positions)
            {
                { var pos = position; }
                <div class="position-container form-group col-6">
                    <SfCheckBox @bind-Checked="PositionsData.SelectedPositions[position.Id].PositionWasSelected" />
                    <label class="form-check-label">@position.Name</label>
                </div>
            }
        }
    </div>
    <RegisterSectionButtonContainer PreviousSectionRequested="HandlePreviousSectionRequested" Progress="3"/>
</EditForm>

